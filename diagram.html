<!-- diagram.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Connections</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css"/>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .diagram-container {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }
    
    .info-panel {
      width: 350px;
      background: linear-gradient(135deg, #1a1410 0%, #0f0d0a 100%);
      border: 2px solid #c9a961;
      border-radius: 4px;
      padding: 25px;
      height: 800px;
      overflow-y: auto;
      box-shadow: 0 4px 15px rgba(201, 169, 97, 0.3);
      flex-shrink: 0;
    }
    
    .character-portrait {
      width: 100%;
      height: 200px;
      background: rgba(201, 169, 97, 0.1);
      border: 2px solid #c9a961;
      border-radius: 4px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #8a7548;
      font-style: italic;
      overflow: hidden;
    }
    
    .character-portrait img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .info-panel h3 {
      margin-top: 0;
      color: #d4af37;
      text-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
      font-size: 1.5em;
      border-bottom: 1px solid #c9a961;
      padding-bottom: 10px;
    }
    
    .info-panel p {
      color: #c9a961;
      line-height: 1.6;
    }
    
    .info-panel strong {
      color: #d4af37;
    }
    
    .info-panel .placeholder {
      color: #8a7548;
      font-style: italic;
    }
    
    .connection-hint {
      background: rgba(201, 169, 97, 0.1);
      border-left: 4px solid #d4af37;
      padding: 12px;
      margin-top: 15px;
      border-radius: 4px;
      font-size: 0.9em;
      color: #c9a961;
    }
    
    .family-node {
      stroke-width: 3px;
      filter: drop-shadow(0 0 8px rgba(201, 169, 97, 0.4));
    }
    
    .character-node {
      stroke-width: 2px;
      filter: drop-shadow(0 0 5px rgba(201, 169, 97, 0.3));
    }
    
    .selected {
      stroke: #d4af37 !important;
      stroke-width: 5px !important;
      filter: drop-shadow(0 0 12px rgba(212, 175, 55, 0.8)) !important;
    }
    
    .ravenscroft-node {
      filter: drop-shadow(0 0 8px rgba(139, 0, 0, 0.5)) !important;
    }
    
    .ravenscroft-node.selected {
      filter: drop-shadow(0 0 15px rgba(139, 0, 0, 0.8)) !important;
    }
    
    /* Controls Bar */
    .controls-bar {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      background: rgba(10, 10, 10, 0.9);
      border: 1px solid #c9a961;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 20px;
      font-size: 0.9em;
      color: #c9a961;
      backdrop-filter: blur(5px);
      gap: 30px;
    }
    
    .controls-section {
      flex: 1;
    }
    
    .controls-section h4, .legend-section h4 {
      margin: 0 0 10px 0;
      color: #d4af37;
      font-size: 1em;
    }
    
    .toggle-group {
      display: flex;
      gap: 15px;
      margin-bottom: 10px;
    }
    
    .toggle-group label {
      display: flex;
      align-items: center;
      cursor: pointer;
      font-size: 0.9em;
    }
    
    .toggle-group input[type="checkbox"] {
      margin-right: 6px;
      accent-color: #d4af37;
    }
    
    .preset-buttons {
      display: flex;
      gap: 8px;
    }
    
    .preset-buttons button {
      background: #c9a961;
      color: #0a0a0a;
      border: none;
      padding: 6px 12px;
      border-radius: 3px;
      font-size: 0.85em;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .preset-buttons button:hover {
      background: #d4af37;
    }
    
    .legend-section {
      flex: 1.5;
    }
    
    .legend-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      font-size: 0.85em;
    }
    
    .legend-circle {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 6px;
      border: 1px solid #666;
    }
    
    @media (max-width: 768px) {
      .controls-bar {
        flex-direction: column;
        gap: 15px;
        padding: 12px;
        font-size: 0.85em;
      }
      
      .toggle-group {
        flex-direction: column;
        gap: 8px;
      }
      
      .legend-items {
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
      }
      
      .legend-item {
        font-size: 0.8em;
      }
      
      .legend-circle {
        width: 10px;
        height: 10px;
        margin-right: 4px;
      }
    }

    
    .info-panel::-webkit-scrollbar {
      width: 8px;
    }
    
    .info-panel::-webkit-scrollbar-track {
      background: #0f0d0a;
      border-radius: 4px;
    }
    
    .info-panel::-webkit-scrollbar-thumb {
      background: #c9a961;
      border-radius: 4px;
    }
    
    .info-panel::-webkit-scrollbar-thumb:hover {
      background: #d4af37;
    }
    
    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .diagram-container {
        flex-direction: column;
        gap: 15px;
      }
      
      main {
        padding-top: 10px;
      }
      
      .info-panel {
        width: 100%;
        height: 45vh;
        order: 2;
        padding: 20px;
        min-height: 300px;
      }
      
      .character-portrait {
        height: 150px;
      }
      
      .info-panel h3 {
        font-size: 1.3em;
      }
      
      #diagram {
        order: 1;
        max-width: 100%;
        height: auto;
        max-height: 40vh;
      }
      
      /* Hide connection hint on very small screens */
      .connection-hint {
        display: none;
      }
    }
    
    @media (max-width: 480px) {
      .info-panel {
        height: 300px;
        padding: 15px;
      }
      
      .character-portrait {
        height: 120px;
      }
      
      .info-panel h3 {
        font-size: 1.2em;
      }
      
      .info-panel p {
        font-size: 0.9em;
      }
      
      /* Improve touch targets */
      circle {
        cursor: pointer;
      }
      
      /* Add mobile instruction */
      .mobile-instruction {
        display: block;
        background: rgba(201, 169, 97, 0.1);
        border: 1px solid #c9a961;
        border-radius: 4px;
        padding: 10px;
        margin-bottom: 15px;
        font-size: 0.85em;
        color: #c9a961;
        text-align: center;
      }
      
      /* Mobile zoom controls */
      .mobile-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        z-index: 1000;
      }
      
      .zoom-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #1a1410 0%, #0f0d0a 100%);
        border: 2px solid #c9a961;
        color: #d4af37;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(201, 169, 97, 0.3);
        transition: all 0.3s ease;
        user-select: none;
      }
      
      .zoom-btn:hover, .zoom-btn:active {
        background: linear-gradient(135deg, #2a2420 0%, #1f1d1a 100%);
        box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        transform: scale(1.1);
      }
      
      /* Make SVG container pannable */
      #diagram {
        touch-action: none;
        user-select: none;
      }
    }
    
    @media (min-width: 481px) {
      .mobile-instruction {
        display: none;
      }
    }
    
    @media (min-width: 769px) {
      .mobile-controls {
        display: none !important;
      }
    }
    
    /* Card-style navigation */
    nav {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px 0;
      flex-wrap: wrap;
    }
    
    nav a {
      background: linear-gradient(135deg, #1a1410 0%, #0f0d0a 100%);
      color: #c9a961;
      text-decoration: none;
      padding: 15px 25px;
      border: 2px solid #c9a961;
      border-radius: 8px;
      font-family: 'Cinzel', serif;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(201, 169, 97, 0.2);
    }
    
    nav a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
      transition: left 0.5s ease;
    }
    
    nav a:hover::before {
      left: 100%;
    }
    
    nav a:hover {
      color: #d4af37;
      border-color: #d4af37;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
      text-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
    }
    
    @media (max-width: 768px) {
      header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: linear-gradient(135deg, #1a1410 0%, #0f0d0a 100%);
        border-bottom: 2px solid #c9a961;
        padding-bottom: 15px;
        margin-bottom: 20px;
      }
      
      nav {
        flex-direction: row;
        justify-content: space-around;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
      }
      
      nav a {
        width: auto;
        min-width: 80px;
        text-align: center;
        font-size: 0.9em;
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body>
<header>
  <h1>The Connections</h1>
  <nav>
    <a href="index.html">🏰 Home</a>
    <a href="characters.html">🎭 Characters</a>
    <a href="families.html">👑 Families</a>
  </nav>
</header>
<main>
  <!-- Controls Bar -->
  <div class="controls-bar">
    <div class="controls-section">
      <h4>View Controls</h4>
      <div class="toggle-group">
        <label>
          <input type="checkbox" id="show-families" checked>
          <span>Families</span>
        </label>
        <label>
          <input type="checkbox" id="show-characters" checked>
          <span>Characters</span>
        </label>
      </div>
      <div class="preset-buttons">
        <button id="families-only">Families Only</button>
        <button id="show-all">Show All</button>
      </div>
    </div>
    <div class="legend-section">
      <h4>Legend</h4>
      <div class="legend-items">
        <div class="legend-item">
          <div class="legend-circle" style="background: #CD5C5C; border-color: #8B0000;"></div>
          <span>Ravenscroft</span>
        </div>
        <div class="legend-item">
          <div class="legend-circle" style="background: #d4af37;"></div>
          <span>Other Families</span>
        </div>
        <div class="legend-item">
          <span style="border-bottom: 2px solid #666;">━━</span> Family Bond
        </div>
        <div class="legend-item">
          <span style="border-bottom: 2px dashed #c9a961;">━━</span> Personal
        </div>
        <div class="legend-item">
          <span style="border-bottom: 2px dashed #4CAF50;">━━</span> Familial
        </div>
        <div class="legend-item">
          <span style="border-bottom: 2px dotted #9370DB;">━━</span> Inter-Family
        </div>
      </div>
    </div>
  </div>

  <div class="diagram-container">
    <svg id="diagram"></svg>
    <div class="info-panel">
      <div id="info-content">
        <div class="placeholder">
          <div class="mobile-instruction">
            📱 Tap characters above to view details here. Use pinch to zoom and drag to pan the diagram.
          </div>
          <p>Click on a character or family to see more information</p>
          <p style="margin-top: 10px;">Click the <strong>dashed lines</strong> between characters to see their relationships!</p>
          <p style="margin-top: 15px; font-weight: bold; color: #8B0000;">The Ravenscroft are at the center - they're the hosts of this fateful gathering.</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Mobile zoom controls -->
  <div class="mobile-controls">
    <div class="zoom-btn" id="zoom-in" title="Zoom In">+</div>
    <div class="zoom-btn" id="zoom-out" title="Zoom Out">−</div>
    <div class="zoom-btn" id="reset-view" title="Reset View">⌂</div>
  </div>
</main>
<script>
// Character and family data with detailed information
const characterInfo = {
  // Ravenscroft Family
  "Lavinia Ravenscroft": {
    type: "character",
    family: "Ravenscroft",
    occupation: "Society Hostess & Patroness of the Arts",
    backstory: "Elegant, ambitious, and gracious, Lavinia married into wealth but keeps her true affections hidden."
  },
  "Cornelius Ravenscroft": {
    type: "character",
    family: "Ravenscroft",
    occupation: "Mining Magnate & Estate Owner",
    backstory: "Stubborn patriarch, obsessed with family grandeur. Known for his temper but fiercely loyal."
  },
  "Bartholomew Ravenscroft": {
    type: "character",
    family: "Ravenscroft",
    occupation: "Disgraced Horse Breeder & Gentleman of Leisure",
    backstory: "Reckless and charming, financially ruined but maintains his warm humor. Relies on his brother's indulgence."
  },
  "Minerva Ravenscroft": {
    type: "character",
    family: "Ravenscroft",
    occupation: "Poet & Women's Rights Advocate",
    backstory: "Free-spirited and courageous sister to Lavinia, she distrusts Ravenscroft rigidity."
  },
  // Whitcombe Family
  "Algernon Whitcombe": {
    type: "character",
    family: "Whitcombe",
    occupation: "Alchemist & Chemical Researcher",
    backstory: "Odd, bookish alchemist, respected but peculiar. Brilliant and surprisingly kind."
  },
  "Nelle Whitcombe": {
    type: "character",
    family: "Whitcombe",
    occupation: "Society Columnist & Information Broker",
    backstory: "Quiet but calculating, gathers gossip as currency. Sharp-witted and observant."
  },
  // Vale Family
  "Karissa Vale": {
    type: "character",
    family: "Vale",
    occupation: "Textile Heiress & Philanthropist",
    backstory: "Proud, wealthy wife, protective of her reputation. Dignified and charitable."
  },
  "Jasper Vale": {
    type: "character",
    family: "Vale",
    occupation: "Professional Gambler & Failed Investor",
    backstory: "Charming gambler, hopelessly indebted but genuinely likeable."
  },
  "Florence Vale": {
    type: "character",
    family: "Vale",
    occupation: "Aspiring Painter & Art Dealer",
    backstory: "Dreamy, resentful brother to Jasper. Talented and sensitive."
  },
  // Ashworth Family
  "Donovan Ashworth": {
    type: "character",
    family: "Ashworth",
    occupation: "Military Officer (on leave) & Duelist",
    backstory: "Entitled, reckless son of Mortimer. Brave and honorable when it matters."
  },
  "Mortimer Ashworth": {
    type: "character",
    family: "Ashworth",
    occupation: "Banking Executive & Political Advisor",
    backstory: "Stern patriarch with powerful ties. Principled and strategic."
  },
  "Digory Ashworth": {
    type: "character",
    family: "Ashworth",
    occupation: "Law Student in Study",
    backstory: "Idealistic son, desperate to be seen as capable. Passionate about justice."
  },
  "Silas Ashworth": {
    type: "character",
    family: "Ashworth",
    occupation: "Explorer & Antiquities Collector",
    backstory: "World-weary traveler, conceals dangerous knowledge. Wise and well-traveled."
  },
  // Blackwood Family
  "Honoria Blackwood": {
    type: "character",
    family: "Blackwood",
    occupation: "Beauty Parlour Owner",
    backstory: "Socialite, jealous of Lavinia. Creative and fashion-forward."
  },
  "Selene Blackwood": {
    type: "character",
    family: "Blackwood",
    occupation: "Spiritualist Medium & Occultist",
    backstory: "Mysterious and mystic sister of Honoria. Intuitive and empathetic."
  },
  // Carroway Family
  "Maximilian Carroway": {
    type: "character",
    family: "Carroway",
    occupation: "Former Mining Engineer & Investment Speculator",
    backstory: "Distant cousin, fallen on hard times. Intelligent and resourceful."
  },
  "Vivienne Blackwood Carroway": {
    type: "character",
    family: "Blackwood",
    occupation: "Philanthropist & Marriage Strategist",
    backstory: "Born a Blackwood, married Maximilian Carroway to unite families. Devoted wife scheming to save husband from financial ruin. Resourceful and determined."
  },
  // Moreau Family
  "Francesca Moreau": {
    type: "character",
    family: "Moreau",
    occupation: "Apothecary & Herbalist",
    backstory: "Mysterious, rumored to deal in potions. Knowledgeable and healing."
  },
  "Augustus Moreau": {
    type: "character",
    family: "Moreau",
    occupation: "University Professor & Former Tutor",
    backstory: "Intelligent scholar, concerned by his wife's dealings. Dedicated and learned."
  },
  "Anastasia Moreau": {
    type: "character",
    family: "Moreau",
    occupation: "Amateur Detective and Journalist",
    backstory: "Clever daughter, more observant than she seems. Curious and insightful."
  }
};

const familyInfo = {
  "Ravenscroft Family": {
    type: "family",
    description: "The central family, wealthy and feared, hosting the masquerade in their estate.",
    members: ["Lavinia", "Cornelius", "Bartholomew", "Minerva"],
    reputation: "Old money with dark secrets"
  },
  "Whitcombe Family": {
    type: "family",
    description: "Ambitious and calculating, with ties to business and society scandals.",
    members: ["Algernon", "Nelle"],
    reputation: "Alchemists and gossip collectors"
  },
  "Vale Family": {
    type: "family",
    description: "Wealthy and proud, protective of their reputation at all costs.",
    members: ["Karissa", "Jasper", "Florence"],
    reputation: "Gambling debts and forbidden passions"
  },
  "Ashworth Family": {
    type: "family",
    description: "Stern family with powerful ties and a reputation for ruthlessness.",
    members: ["Mortimer", "Donovan", "Digory", "Silas"],
    reputation: "Powerful connections and dangerous secrets"
  },
  "Blackwood Family": {
    type: "family",
    description: "Vain socialites consumed by jealousy and competition.",
    members: ["Honoria", "Selene", "Vivienne (married to Maximilian Carroway)"],
    reputation: "Beauty, rivalry, and strategic marriages"
  },
  "Carroway Family": {
    type: "family",
    description: "Distant cousins fallen on hard times, desperate to restore their fortunes.",
    members: ["Maximilian (married to Vivienne Blackwood)", "Vivienne"],
    reputation: "Strategic marriages and financial recovery"
  },
  "Moreau Family": {
    type: "family",
    description: "Mysterious and cunning, rumored to deal in potions and dark arts.",
    members: ["Francesca", "Archibald", "Anastasia"],
    reputation: "Dangerous knowledge and manipulation"
  }
};

// Create nodes with family grouping information - all 22 characters + 7 families
const nodes = [
  // Ravenscroft Family (group 1)
  { id: "Lavinia Ravenscroft", type: "character", family: "Ravenscroft", group: 1 },
  { id: "Cornelius Ravenscroft", type: "character", family: "Ravenscroft", group: 1 },
  { id: "Bartholomew Ravenscroft", type: "character", family: "Ravenscroft", group: 1 },
  { id: "Minerva Ravenscroft", type: "character", family: "Ravenscroft", group: 1 },
  { id: "Ravenscroft Family", type: "family", family: "Ravenscroft", group: 1 },
  
  // Whitcombe Family (group 2)
  { id: "Algernon Whitcombe", type: "character", family: "Whitcombe", group: 2 },
  { id: "Nelle Whitcombe", type: "character", family: "Whitcombe", group: 2 },
  { id: "Whitcombe Family", type: "family", family: "Whitcombe", group: 2 },
  
  // Vale Family (group 3)
  { id: "Karissa Vale", type: "character", family: "Vale", group: 3 },
  { id: "Jasper Vale", type: "character", family: "Vale", group: 3 },
  { id: "Florence Vale", type: "character", family: "Vale", group: 3 },
  { id: "Vale Family", type: "family", family: "Vale", group: 3 },
  
  // Ashworth Family (group 4)
  { id: "Donovan Ashworth", type: "character", family: "Ashworth", group: 4 },
  { id: "Mortimer Ashworth", type: "character", family: "Ashworth", group: 4 },
  { id: "Digory Ashworth", type: "character", family: "Ashworth", group: 4 },
  { id: "Silas Ashworth", type: "character", family: "Ashworth", group: 4 },
  { id: "Ashworth Family", type: "family", family: "Ashworth", group: 4 },
  
  // Blackwood Family (group 5)
  { id: "Honoria Blackwood", type: "character", family: "Blackwood", group: 5 },
  { id: "Selene Blackwood", type: "character", family: "Blackwood", group: 5 },
  { id: "Blackwood Family", type: "family", family: "Blackwood", group: 5 },
  
  // Carroway Family (group 6)
  { id: "Maximilian Carroway", type: "character", family: "Carroway", group: 6 },
  { id: "Vivienne Blackwood Carroway", type: "character", family: "Blackwood", group: 5 },
  { id: "Carroway Family", type: "family", family: "Carroway", group: 6 },
  
  // Moreau Family (group 7)
  { id: "Francesca Moreau", type: "character", family: "Moreau", group: 7 },
  { id: "Augustus Moreau", type: "character", family: "Moreau", group: 7 },
  { id: "Anastasia Moreau", type: "character", family: "Moreau", group: 7 },
  { id: "Moreau Family", type: "family", family: "Moreau", group: 7 }
];

// Create links - family connections and key relationships
const links = [
  // Ravenscroft Family connections
  { source: "Lavinia Ravenscroft", target: "Ravenscroft Family", type: "family" },
  { source: "Cornelius Ravenscroft", target: "Ravenscroft Family", type: "family" },
  { source: "Bartholomew Ravenscroft", target: "Ravenscroft Family", type: "family" },
  { source: "Minerva Ravenscroft", target: "Ravenscroft Family", type: "family" },
  
  // Whitcombe Family connections
  { source: "Algernon Whitcombe", target: "Whitcombe Family", type: "family" },
  { source: "Nelle Whitcombe", target: "Whitcombe Family", type: "family" },
  
  // Vale Family connections
  { source: "Karissa Vale", target: "Vale Family", type: "family" },
  { source: "Jasper Vale", target: "Vale Family", type: "family" },
  { source: "Florence Vale", target: "Vale Family", type: "family" },
  
  // Ashworth Family connections
  { source: "Donovan Ashworth", target: "Ashworth Family", type: "family" },
  { source: "Mortimer Ashworth", target: "Ashworth Family", type: "family" },
  { source: "Digory Ashworth", target: "Ashworth Family", type: "family" },
  { source: "Silas Ashworth", target: "Ashworth Family", type: "family" },
  
  // Blackwood Family connections
  { source: "Honoria Blackwood", target: "Blackwood Family", type: "family" },
  { source: "Selene Blackwood", target: "Blackwood Family", type: "family" },
  
  // Carroway Family connections
  { source: "Maximilian Carroway", target: "Carroway Family", type: "family" },
  { source: "Vivienne Blackwood Carroway", target: "Blackwood Family", type: "family" },
  { source: "Vivienne Blackwood Carroway", target: "Carroway Family", type: "family" },
  
  // Moreau Family connections
  { source: "Francesca Moreau", target: "Moreau Family", type: "family" },
  { source: "Augustus Moreau", target: "Moreau Family", type: "family" },
  { source: "Anastasia Moreau", target: "Moreau Family", type: "family" },
  
  // Key relationship connections (based on clues and backstories)
  
  // Familial relationships (blood relations and marriages)
  { source: "Cornelius Ravenscroft", target: "Bartholomew Ravenscroft", type: "familial", description: "Brothers - Cornelius is the elder, more responsible brother" },
  { source: "Lavinia Ravenscroft", target: "Minerva Ravenscroft", type: "familial", description: "Sisters - Minerva is Lavinia's free-spirited sister" },
  { source: "Mortimer Ashworth", target: "Donovan Ashworth", type: "familial", description: "Father and son - Mortimer is stern patriarch, Donovan is entitled son" },
  { source: "Mortimer Ashworth", target: "Digory Ashworth", type: "familial", description: "Father and son - Digory is the idealistic younger son" },
  { source: "Mortimer Ashworth", target: "Silas Ashworth", type: "familial", description: "Brothers - Silas is Mortimer's world-weary brother" },
  { source: "Honoria Blackwood", target: "Selene Blackwood", type: "familial", description: "Sisters" },
  { source: "Jasper Vale", target: "Florence Vale", type: "familial", description: "Brothers - Florence resents charming gambler Jasper" },
  { source: "Francesca Moreau", target: "Anastasia Moreau", type: "familial", description: "Mother and daughter - Anastasia uses her mother's connections for investigative access" },
  { source: "Algernon Whitcombe", target: "Nelle Whitcombe", type: "familial", description: "Brother and sister - Algernon is the bookish alchemist, Nelle the calculating gossip" },
  { source: "Vivienne Blackwood Carroway", target: "Selene Blackwood", type: "familial", description: "Sisters - Vivienne married into Carroway family, Selene is the oldest" },
  { source: "Vivienne Blackwood Carroway", target: "Honoria Blackwood", type: "familial", description: "Sisters - Vivienne is youngest, Honoria is the middle child" },
  
  // Marriage relationships
  { source: "Lavinia Ravenscroft", target: "Cornelius Ravenscroft", type: "familial", description: "Husband and wife - married into wealth with hidden tensions" },
  { source: "Karissa Vale", target: "Jasper Vale", type: "familial", description: "Husband and wife - Karissa married the charming gambler" },
  { source: "Vivienne Blackwood Carroway", target: "Maximilian Carroway", type: "familial", description: "Husband and wife - strategic marriage to unite struggling families" },
  { source: "Augustus Moreau", target: "Francesca Moreau", type: "familial", description: "Husband and wife - Augustus overshadowed by cunning Francesca" },

  // Personal relationships
  { source: "Jasper Vale", target: "Cornelius Ravenscroft", type: "relationship", description: "Gambling debts owed to Cornelius" },
  { source: "Selene Blackwood", target: "Minerva Ravenscroft", type: "relationship", description: "Former companion, mysterious ending" },
  { source: "Francesca Moreau", target: "Bartholomew Ravenscroft", type: "relationship", description: "Supplier of remedies, frequent customer" },
  { source: "Mortimer Ashworth", target: "Cornelius Ravenscroft", type: "relationship", description: "Annual hunting party attendees" },
  { source: "Nelle Whitcombe", target: "Anastasia Moreau", type: "relationship", description: "Secret notes passed between them" },
  { source: "Honoria Blackwood", target: "Lavinia Ravenscroft", type: "relationship", description: "Bitter social rivals since Lavinia's debut" },

  { source: "Karissa Vale", target: "Lavinia Ravenscroft", type: "relationship", description: "Childhood friends, now strained relationship" },


  { source: "Maximilian Carroway", target: "Cornelius Ravenscroft", type: "relationship", description: "Mining venture partners, arguing over profits" },
  { source: "Algernon Whitcombe", target: "Cornelius Ravenscroft", type: "relationship", description: "Long-time friends, hunting party companions" },
  { source: "Florence Vale", target: "Cornelius Ravenscroft", type: "relationship", description: "Spent late nights discussing strange topics." },
  { source: "Silas Ashworth", target: "Cornelius Ravenscroft", type: "relationship", description: "Specially invited by Cornelius for unknown reasons" },
  { source: "Nelle Whitcombe", target: "Lavinia Ravenscroft", type: "relationship", description: "Direct invitation from Lavinia, causing confusion" },
  { source: "Jasper Vale", target: "Bartholomew Ravenscroft", type: "relationship", description: "Frequent same gentleman's clubs" },
  { source: "Honoria Blackwood", target: "Lavinia Ravenscroft", type: "relationship", description: "These two have been seen spending a lot of time together" },
  { source: "Augustus Moreau", target: "Cornelius Ravenscroft", type: "relationship", description: "Former tutor, dismissed after disagreement" },
  { source: "Anastasia Moreau", target: "Cornelius Ravenscroft", type: "relationship", description: "Investigating his business practices for exposé article - he discovered her true motives" },
  { source: "Donovan Ashworth", target: "Blackwood Family", type: "relationship", description: "Served as protection for the Blackwood family on a business trip"},

  // New triangle connection: Digory, Maximilian, and Cornelius
  { source: "Digory Ashworth", target: "Maximilian Carroway", type: "relationship", description: "Secret business arrangement regarding mining investments" },
  { source: "Digory Ashworth", target: "Cornelius Ravenscroft", type: "relationship", description: "Desperate to prove himself worthy of family mining empire" },

  // Inter-Family Connections based on families.html
  { source: "Ravenscroft Family", target: "Whitcombe Family", type: "inter-family", description: "Strong friendship between patriarchs, mysterious invitation to Nelle" },
  { source: "Ravenscroft Family", target: "Vale Family", type: "inter-family", description: "Financial entanglements, gambling debts, strained childhood friendship" },
  { source: "Ravenscroft Family", target: "Ashworth Family", type: "inter-family", description: "Annual hunting parties, mysterious circumstances at last gathering" },
  { source: "Ravenscroft Family", target: "Blackwood Family", type: "inter-family", description: "Bitter social rivalry, past courtship rumors, power balance shifts" },
  { source: "Ravenscroft Family", target: "Carroway Family", type: "inter-family", description: "Joint mining venture, declining profits, heated arguments" },
  { source: "Ravenscroft Family", target: "Moreau Family", type: "inter-family", description: "Mysterious remedies, dangerous knowledge, significant favors owed" },
  { source: "Blackwood Family", target: "Carroway Family", type: "inter-family", description: "Strategic marriage alliance between Vivienne Blackwood and Maximilian Carroway" },
  { source: "Whitcombe Family", target: "Moreau Family", type: "inter-family", description: "Alchemical secret exchange between Algernon and Francesca, shared knowledge of rare formulations" },
  { source: "Vale Family", target: "Ashworth Family", type: "inter-family", description: "Historical business partnership - Ashworth banking connections helped establish Vale textile empire" }
];

const svg = d3.select("#diagram");

// Responsive dimensions
function getResponsiveDimensions() {
  const containerWidth = document.querySelector('.diagram-container').clientWidth;
  const isMobile = window.innerWidth <= 768;
  
  if (isMobile) {
    const availableWidth = Math.min(containerWidth, window.innerWidth - 20);
    return {
      width: availableWidth,
      height: Math.min(400, window.innerHeight * 0.4)
    };
  } else {
    const panelWidth = 350; // info panel width
    const gap = 20; // container gap
    return {
      width: Math.max(650, containerWidth - panelWidth - gap),
      height: 800
    };
  }
}

const dimensions = getResponsiveDimensions();
const width = dimensions.width;
const height = dimensions.height;

svg.attr("width", width).attr("height", height).attr("viewBox", `0 0 ${width} ${height}`);

// Create zoom behavior for mobile panning
const zoom = d3.zoom()
  .scaleExtent([0.3, 3])
  .on("zoom", function(event) {
    container.attr("transform", event.transform);
  });

// Apply zoom behavior to SVG
svg.call(zoom);

// Create container group for all elements
const container = svg.append("g");

// Add arrowhead markers for directional relationships
svg.append("defs").selectAll("marker")
  .data(["relationship", "family", "familial", "inter-family"])
  .enter().append("marker")
  .attr("id", d => `arrowhead-${d}`)
  .attr("viewBox", "0 -5 10 10")
  .attr("refX", 15)
  .attr("refY", 0)
  .attr("markerWidth", 6)
  .attr("markerHeight", 6)
  .attr("orient", "auto")
  .append("path")
  .attr("d", "M0,-5L10,0L0,5")
  .attr("fill", d => {
    if (d === "family") return "#666";
    if (d === "familial") return "#4CAF50";
    if (d === "inter-family") return "#9370DB";
    return "#c9a961";
  })
  .attr("opacity", d => d === "family" ? 0.6 : 0.8);


// Color scale for different families (7 families) - Masquerade theme
const colorScale = d3.scaleOrdinal()
  .domain([1, 2, 3, 4, 5, 6, 7])
  .range(["#d4af37", "#c9a961", "#b8860b", "#cd853f", "#daa520", "#b8956a", "#8b7355"]);

// Function to calculate node positions based on family hierarchy
function getNodePosition(d) {
  const centerX = width / 2;
  const centerY = height / 2;
  
  // Ravenscroft family at center
  if (d.family === "Ravenscroft") {
    if (d.type === "family") {
      return { x: centerX, y: centerY };
    }
    // Arrange Ravenscroft characters in a tight circle around center
    const ravenscroftMembers = ["Lavinia Ravenscroft", "Cornelius Ravenscroft", "Bartholomew Ravenscroft", "Minerva Ravenscroft"];
    const index = ravenscroftMembers.indexOf(d.id);
    const angle = (index / ravenscroftMembers.length) * 2 * Math.PI - Math.PI / 2; // Start from top
    const radius = Math.min(width, height) * 0.08; // Small radius for tight grouping
    return {
      x: centerX + Math.cos(angle) * radius,
      y: centerY + Math.sin(angle) * radius
    };
  }
  
  // Other families arranged in concentric rings around Ravenscroffs
  const familyOrder = ["Whitcombe", "Vale", "Ashworth", "Blackwood", "Carroway", "Moreau"];
  const familyIndex = familyOrder.indexOf(d.family);
  
  if (familyIndex !== -1) {
    // Family nodes in inner ring
    if (d.type === "family") {
      const angle = (familyIndex / familyOrder.length) * 2 * Math.PI - Math.PI / 2;
      const radius = Math.min(width, height) * 0.25;
      return {
        x: centerX + Math.cos(angle) * radius,
        y: centerY + Math.sin(angle) * radius
      };
    }
    
    // Character nodes in outer ring, grouped by family
    const angle = (familyIndex / familyOrder.length) * 2 * Math.PI - Math.PI / 2;
    const baseRadius = Math.min(width, height) * 0.35;
    
    // Get family members to arrange them around their family center
    const familyMembers = nodes.filter(n => n.family === d.family && n.type === "character");
    const memberIndex = familyMembers.findIndex(n => n.id === d.id);
    const memberCount = familyMembers.length;
    
    // Spread members around their family's section
    const memberAngle = angle + ((memberIndex - (memberCount - 1) / 2) * 0.3);
    const memberRadius = baseRadius + (memberCount > 2 ? 30 : 0);
    
    return {
      x: centerX + Math.cos(memberAngle) * memberRadius,
      y: centerY + Math.sin(memberAngle) * memberRadius
    };
  }
  
  // Fallback for any unmatched nodes
  return { x: centerX, y: centerY };
}

// Create simulation with hierarchical positioning
const simulation = d3.forceSimulation(nodes)
  .force("link", d3.forceLink(links).id(d => d.id).distance(d => {
    // Shorter distances for family connections, longer for relationships
    if (d.type === "family") return 40;
    if (d.type === "familial") return 80;
    if (d.type === "inter-family") return 180;
    return 140;
  }))
  .force("charge", d3.forceManyBody().strength(d => {
    if (d.family === "Ravenscroft") return -400; // Stronger repulsion for central family
    if (d.type === "family") return -350; // Family nodes repel more
    return -250; // Character nodes
  }))
  .force("center", d3.forceCenter(width / 2, height / 2))
  .force("collision", d3.forceCollide().radius(d => {
    if (d.family === "Ravenscroft") return d.type === "family" ? 50 : 42;
    return d.type === "family" ? 45 : 38;
  }))
  // Use hierarchical positioning with stronger force for better organization
  .force("x", d3.forceX().x(d => getNodePosition(d).x).strength(0.4))
  .force("y", d3.forceY().y(d => getNodePosition(d).y).strength(0.4));

// State for connection filtering
let selectedNode = null;
let showOnlyConnections = false;

// Function to filter and show/hide connections
function toggleConnectionsFilter(nodeData) {
  if (selectedNode === nodeData.id && showOnlyConnections) {
    // If clicking the same node and filter is active, turn off filter
    selectedNode = null;
    showOnlyConnections = false;
    // Show all links
    link.style("opacity", d => d.type === "family" ? 0.6 : 0.7)
        .style("display", "block");
  } else {
    // Set new selected node and activate filter
    selectedNode = nodeData.id;
    showOnlyConnections = true;
    // Hide all links first
    link.style("opacity", 0.1)
        .style("display", "block");
    // Show only links connected to selected node
    link.filter(d => 
      (d.source.id || d.source) === selectedNode || 
      (d.target.id || d.target) === selectedNode
    ).style("opacity", d => d.type === "family" ? 0.6 : 0.7);
  }
}

// Create links with arrowheads for direction
const link = container.append("g")
  .selectAll("line")
  .data(links)
  .enter().append("line")
  .attr("stroke", d => {
    if (d.type === "family") return "#666";
    if (d.type === "familial") return "#4CAF50";
    if (d.type === "inter-family") return "#9370DB";
    return "#c9a961";
  })
  .attr("stroke-width", d => {
    if (d.type === "family") return 2.5;
    if (d.type === "inter-family") return 2;
    return 3;
  })
  .attr("stroke-dasharray", d => {
    if (d.type === "relationship") return "8,4";
    if (d.type === "familial") return "4,2";
    if (d.type === "inter-family") return "2,3";
    return "none";
  })
  .attr("stroke-opacity", d => {
    if (d.type === "family") return 0.6;
    if (d.type === "inter-family") return 0.5;
    return 0.7;
  })
  .attr("marker-end", d => `url(#arrowhead-${d.type})`)
  .style("cursor", d => d.description ? "pointer" : "default")
  .style("stroke-linecap", "round")
  .on("click", function(event, d) {
    if (d.description) {
      event.stopPropagation();
      const infoContent = document.getElementById('info-content');
      infoContent.innerHTML = `
        <h3>Connection Details</h3>
        <p><strong>From:</strong> ${d.source.id || d.source}</p>
        <p><strong>To:</strong> ${d.target.id || d.target}</p>
        <p><strong>Type:</strong> ${
          d.type === "family" ? "Family Bond" : 
          d.type === "familial" ? "Familial Relationship" : 
          d.type === "inter-family" ? "Inter-Family Connection" :
          "Personal Relationship"
        }</p>
        <p><strong>Description:</strong> ${d.description}</p>
      `;
    }
  });

// Create nodes with enhanced styling for Ravenscroffs
const node = container.append("g")
  .selectAll("circle")
  .data(nodes)
  .enter().append("circle")
  .attr("r", d => {
    if (d.family === "Ravenscroft" && d.type === "family") return 35; // Larger for Ravenscroft family
    if (d.family === "Ravenscroft") return 28; // Larger for Ravenscroft characters
    return d.type === "family" ? 30 : 25;
  })
  .attr("fill", d => {
    if (d.family === "Ravenscroft") {
      return d.type === "family" ? "#8B0000" : "#CD5C5C"; // Deep red for Ravenscroffs
    }
    return colorScale(d.group);
  })
  .attr("stroke", d => d.family === "Ravenscroft" ? "#8B0000" : "#0a0a0a")
  .attr("stroke-width", d => d.family === "Ravenscroft" ? 3 : 2)
  .attr("class", d => {
    let classes = d.type === "family" ? "family-node" : "character-node";
    if (d.family === "Ravenscroft") classes += " ravenscroft-node";
    return classes;
  })
  .style("cursor", "pointer")
  .style("filter", d => d.family === "Ravenscroft" ? "drop-shadow(0 0 8px rgba(139, 0, 0, 0.5))" : "none")
  .call(drag(simulation))
  .on("click", function(event, d) {
    // Remove previous selection
    svg.selectAll("circle").classed("selected", false);
    // Add selection to clicked node
    d3.select(this).classed("selected", true);
    // Toggle connection filter
    toggleConnectionsFilter(d);
    // Update info panel
    updateInfoPanel(d);
  });

// Create labels
const label = container.append("g")
  .selectAll("text")
  .data(nodes)
  .enter().append("text")
  .attr("dy", ".35em")
  .attr("text-anchor", "middle")
  .attr("font-size", d => d.type === "family" ? "11px" : "10px")
  .attr("font-weight", d => d.type === "family" ? "bold" : "600")
  .style("pointer-events", "none")
  .style("fill", "#d4af37")
  .style("text-shadow", "0 0 8px rgba(10, 10, 10, 0.9), 0 0 3px rgba(10, 10, 10, 0.9)")
  .text(d => {
    // Wrap long names
    if (d.id.length > 15) {
      const words = d.id.split(' ');
      return words.length > 1 ? words[0] + ' ' + words[words.length - 1] : d.id;
    }
    return d.id;
  });

// Node visibility toggle functionality
function toggleNodeVisibility() {
  const showFamilies = document.getElementById('show-families').checked;
  const showCharacters = document.getElementById('show-characters').checked;
  
  // Toggle node visibility
  node.style("display", d => {
    if (d.type === "family" && !showFamilies) return "none";
    if (d.type === "character" && !showCharacters) return "none";
    return "block";
  });
  
  // Toggle label visibility
  label.style("display", d => {
    if (d.type === "family" && !showFamilies) return "none";
    if (d.type === "character" && !showCharacters) return "none";
    return "block";
  });
  
  // Toggle link visibility based on connected nodes
  link.style("display", d => {
    // Get source and target nodes (handling both object and ID references)
    const sourceNode = typeof d.source === 'object' ? d.source : nodes.find(n => n.id === d.source);
    const targetNode = typeof d.target === 'object' ? d.target : nodes.find(n => n.id === d.target);
    
    if (!sourceNode || !targetNode) return "none";
    
    const sourceVisible = (sourceNode.type === "family" && showFamilies) || 
                          (sourceNode.type === "character" && showCharacters);
    const targetVisible = (targetNode.type === "family" && showFamilies) || 
                          (targetNode.type === "character" && showCharacters);
    return (sourceVisible && targetVisible) ? "block" : "none";
  });
  
  // Restart simulation with reduced alpha for smooth transition
  simulation.alpha(0.1).restart();
}

// Add event listeners for toggle controls
document.getElementById('show-families').addEventListener('change', toggleNodeVisibility);
document.getElementById('show-characters').addEventListener('change', toggleNodeVisibility);


// Update simulation on tick
simulation.on("tick", () => {
  link
    .attr("x1", d => {
      const dx = d.target.x - d.source.x;
      const dy = d.target.y - d.source.y;
      const dr = Math.sqrt(dx * dx + dy * dy);
      const radius = d.source.type === "family" ? 40 : 35;
      return d.source.x + (dx * radius / dr);
    })
    .attr("y1", d => {
      const dx = d.target.x - d.source.x;
      const dy = d.target.y - d.source.y;
      const dr = Math.sqrt(dx * dx + dy * dy);
      const radius = d.source.type === "family" ? 40 : 35;
      return d.source.y + (dy * radius / dr);
    })
    .attr("x2", d => {
      const dx = d.target.x - d.source.x;
      const dy = d.target.y - d.source.y;
      const dr = Math.sqrt(dx * dx + dy * dy);
      const radius = d.target.type === "family" ? 40 : 35;
      return d.target.x - (dx * radius / dr);
    })
    .attr("y2", d => {
      const dx = d.target.x - d.source.x;
      const dy = d.target.y - d.source.y;
      const dr = Math.sqrt(dx * dx + dy * dy);
      const radius = d.target.type === "family" ? 40 : 35;
      return d.target.y - (dy * radius / dr);
    });

  node
    .attr("cx", d => d.x)
    .attr("cy", d => d.y);

  label
    .attr("x", d => d.x)
    .attr("y", d => d.y);
});

// Function to update info panel
function updateInfoPanel(nodeData) {
  const infoContent = document.getElementById('info-content');
  
  if (nodeData.type === "character") {
    const info = characterInfo[nodeData.id];
    infoContent.innerHTML = `
      <div class="character-portrait">
        <span>Character Portrait</span>
      </div>
      <h3>${nodeData.id}</h3>
      <p><strong>Family:</strong> ${info.family}</p>
      <p><strong>Occupation:</strong> ${info.occupation}</p>
      <p style="margin-top: 15px;"><strong>Backstory:</strong></p>
      <p style="margin-left: 10px; font-style: italic;">${info.backstory}</p>
    `;
  } else if (nodeData.type === "family") {
    const info = familyInfo[nodeData.id];
    const membersList = info.members.map(m => `<li>${m}</li>`).join('');
    infoContent.innerHTML = `
      <h3>${nodeData.id}</h3>
      <p style="margin-top: 15px;"><strong>Description:</strong></p>
      <p style="margin-left: 10px; font-style: italic;">${info.description}</p>
      <p style="margin-top: 15px;"><strong>Reputation:</strong></p>
      <p style="margin-left: 10px; font-style: italic;">${info.reputation}</p>
      <div style="background: rgba(201, 169, 97, 0.1); border: 1px solid #c9a961; padding: 15px; border-radius: 4px; margin-top: 15px;">
        <strong style="color: #d4af37;">Members:</strong>
        <ul style="margin: 10px 0; padding-left: 20px; font-size: 0.95em; color: #c9a961;">
          ${membersList}
        </ul>
      </div>
    `;
  }

  // Add filter status if a node is selected
  if (selectedNode) {
    content += `
      <div style="background: rgba(76, 175, 80, 0.1); border: 1px solid #4CAF50; padding: 10px; border-radius: 4px; margin-top: 15px;">
        <strong style="color: #4CAF50;">Connection Filter:</strong>
        <p style="margin: 5px 0; font-size: 0.9em; color: #4CAF50;">
          ${showOnlyConnections ? 
            `Showing only connections to/from <strong>${selectedNode.name}</strong>. Click again to show all connections.` : 
            `Click to show only connections to/from <strong>${selectedNode.name}</strong>.`
          }
        </p>
      </div>
    `;
  }

  infoPanel.innerHTML = content;
}

// Drag functionality
function drag(simulation) {
  function dragstarted(event, d) {
    if (!event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
  }

  function dragged(event, d) {
    d.fx = event.x;
    d.fy = event.y;
  }

  function dragended(event, d) {
    if (!event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
  }

  return d3.drag()
    .on("start", dragstarted)
    .on("drag", dragged)
    .on("end", dragended);
}

// Add resize handler for responsive behavior
let resizeTimeout;
window.addEventListener('resize', function() {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(function() {
    const newDimensions = getResponsiveDimensions();
    const newWidth = newDimensions.width;
    const newHeight = newDimensions.height;
    
    // Update SVG dimensions
    svg.attr("width", newWidth).attr("height", newHeight).attr("viewBox", `0 0 ${newWidth} ${newHeight}`);
    
    // Update width and height variables for the positioning function
    width = newWidth;
    height = newHeight;
    
    // Update simulation forces with new dimensions
    simulation
      .force("center", d3.forceCenter(newWidth / 2, newHeight / 2))
      .force("x", d3.forceX().x(d => getNodePosition(d).x).strength(0.3))
      .force("y", d3.forceY().y(d => getNodePosition(d).y).strength(0.3));
    
    // Restart simulation with alpha for smooth transition
    simulation.alpha(0.3).restart();
    
    // Show/hide mobile controls based on screen size
    const controls = document.querySelector('.mobile-controls');
    if (controls) {
      controls.style.display = window.innerWidth <= 768 ? 'flex' : 'none';
    }
  }, 250); // Debounce resize events
});

// Mobile zoom controls functionality
if (window.innerWidth <= 768) {
  document.getElementById('zoom-in').addEventListener('click', function() {
    svg.transition().call(zoom.scaleBy, 1.5);
  });
  
  document.getElementById('zoom-out').addEventListener('click', function() {
    svg.transition().call(zoom.scaleBy, 0.67);
  });
  
  document.getElementById('reset-view').addEventListener('click', function() {
    svg.transition().call(zoom.transform, d3.zoomIdentity);
  });
  
  // Add double-tap to zoom functionality
  let lastTap = 0;
  svg.on('touchend', function(event) {
    const currentTime = new Date().getTime();
    const tapLength = currentTime - lastTap;
    if (tapLength < 500 && tapLength > 0) {
      event.preventDefault();
      // Double tap detected - zoom in
      svg.transition().call(zoom.scaleBy, 1.5);
    }
    lastTap = currentTime;
  });
}

// Hide mobile controls on desktop
if (window.innerWidth > 768) {
  const controls = document.querySelector('.mobile-controls');
  if (controls) {
    controls.style.display = 'none';
  }
}

// Add event listeners for toggle controls
document.getElementById('show-families').addEventListener('change', toggleNodeVisibility);
document.getElementById('show-characters').addEventListener('change', toggleNodeVisibility);

// Preset button functionality
document.getElementById('families-only').addEventListener('click', function() {
  document.getElementById('show-families').checked = true;
  document.getElementById('show-characters').checked = false;
  toggleNodeVisibility();
});

document.getElementById('show-all').addEventListener('click', function() {
  document.getElementById('show-families').checked = true;
  document.getElementById('show-characters').checked = true;
  toggleNodeVisibility();
});
</script>
</body>
</html>